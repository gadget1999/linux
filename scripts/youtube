#!/usr/bin/env bash

CMD_PATH=$(dirname "$0")
source $CMD_PATH/lib/common.sh

check_env "HOST_DOWNLOAD_ROOT"

[ "$1" == "" ] && show_usage "URL [debug]"

URL=$1

CMD=/usr/local/bin/youtube-dl
if [ ! -x "$(command -v $CMD)" ]; then
 debug "Install youtube-dl"
 sudo pip3 install youtube-dl
fi

TARGET="$HOST_DOWNLOAD_ROOT/Youtube"
[ ! -d $TARGET ] && mkdir $TARGET
cd $TARGET

SPEEDLIMIT=600K
FULL_CMD="$CMD -r $SPEEDLIMIT"
if [ "$2" == "debug" ]; then
 debug "Update youtube-dl"
 sudo pip3 install --upgrade youtube_dl
 $FULL_CMD -v $URL
else
 $FULL_CMD $URL
fi
